<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å²å®¸&æŸéˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary-blue: #e3f2fd; --accent-blue: #2196f3; --text-color: #333; }
        body { font-family: sans-serif; background-color: var(--primary-blue); color: var(--text-color); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        /* é é¢å®¹å™¨ */
        .container { display: none; width: 90%; max-width: 400px; text-align: center; padding-top: 50px; }
        .sub-page { display: none; width: 90%; max-width: 400px; padding: 20px; text-align: left; box-sizing: border-box; }

        /* å¡ç‰‡èˆ‡è¨ˆæ•¸å™¨ */
        .counter { background: white; margin: 30px 0; padding: 30px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .days-number { font-size: 3.5rem; color: var(--accent-blue); font-weight: bold; }

        /* é¸å–®æŒ‰éˆ• */
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .menu-item { background: white; padding: 25px 10px; border-radius: 20px; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; text-align: center; transition: 0.2s; }
        .menu-item:active { transform: scale(0.95); }
        .menu-item i { font-size: 2rem; color: var(--accent-blue); margin-bottom: 10px; }

        /* æ¸…å–®æ¨£å¼ */
        .list-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-left: 5px solid var(--accent-blue); }
        .calendar-link { color: #2196f3; font-size: 0.85rem; text-decoration: none; display: inline-block; margin-top: 8px; font-weight: bold; }
        
        /* è¿”å›èˆ‡æ–°å¢æŒ‰éˆ• */
        .back-btn { font-size: 1.1rem; cursor: pointer; margin-bottom: 20px; color: var(--accent-blue); font-weight: bold; }
        .fab { position: fixed; bottom: 30px; right: 30px; background: var(--accent-blue); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; border: none; box-shadow: 0 4px 15px rgba(33,150,243,0.4); z-index: 100; }
    </style>
</head>
<body>

    <div id="home-page" class="container">
        <h1>å²å®¸ & æŸéˆ</h1>
        <p>è‡ª 2025 å¹´ 5 æœˆ 28 æ—¥èµ·</p>
        <div class="counter">
            <p>æˆ‘å€‘å·²ç¶“åœ¨ä¸€èµ·</p>
            <div class="days-number" id="days-count">0</div>
            <p>DAYS</p>
        </div>
        <div class="menu-grid">
            <div class="menu-item" onclick="showPage('reminders')">
                <i class="fas fa-bell"></i>
                <div>æé†’äº‹é …</div>
            </div>
            <div class="menu-item" onclick="showPage('wishes')">
                <i class="fas fa-star"></i>
                <div>é¡˜æœ› & ç›®æ¨™</div>
            </div>
        </div>
    </div>

    <div id="reminders-page" class="sub-page">
        <div class="back-btn" onclick="showPage('home')"><i class="fas fa-chevron-left"></i> è¿”å›</div>
        <h2><i class="fas fa-bell"></i> æé†’äº‹é …</h2>
        <div id="reminder-list">è®€å–ä¸­...</div>
        <button class="fab" onclick="addNewItem('æé†’')"><i class="fas fa-plus"></i></button>
    </div>

    <div id="wishes-page" class="sub-page">
        <div class="back-btn" onclick="showPage('home')"><i class="fas fa-chevron-left"></i> è¿”å›</div>
        <h2><i class="fas fa-star"></i> é¡˜æœ› & ç›®æ¨™</h2>
        <div id="wish-list">è®€å–ä¸­...</div>
        <button class="fab" onclick="addNewItem('é¡˜æœ›')"><i class="fas fa-plus"></i></button>
    </div>

<script>
    // ä½ çš„ Google éƒ¨ç½²ç¶²å€
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx-1wmkwgtXEV7GSN215qdyrDT4r85XuzhfTMSrS_AxUaErjpLnugdEAB1ycsMiHp0U/exec";

    // 1. å¯†ç¢¼æª¢æŸ¥
    if (!sessionStorage.getItem('isLogged')) {
        const password = prompt("è«‹è¼¸å…¥å¯†ç¢¼");
        if (password === "0528") {
            sessionStorage.setItem('isLogged', 'true');
            document.getElementById('home-page').style.display = 'block';
        } else {
            alert("å¯†ç¢¼éŒ¯èª¤");
            window.location.reload();
        }
    } else {
        document.getElementById('home-page').style.display = 'block';
    }

    // 2. å¤©æ•¸è¨ˆç®— (2025/05/28)
    const startDate = new Date(2025, 4, 28); 
    function updateDays() {
        const today = new Date();
        const diff = Math.floor((today - startDate) / 86400000);
        document.getElementById('days-count').innerText = diff;
    }
    updateDays();

    // 3. åˆ‡æ›é é¢
    function showPage(id) {
        document.querySelectorAll('.container, .sub-page').forEach(p => p.style.display = 'none');
        document.getElementById(id + '-page').style.display = 'block';
        if(id !== 'home') loadCloudData();
    }

    // 4. å¾é›²ç«¯æŠ“å–è³‡æ–™
    async function loadCloudData() {
        try {
            const response = await fetch(SCRIPT_URL);
            const data = await response.json();
            const rList = document.getElementById('reminder-list');
            const wList = document.getElementById('wish-list');
            rList.innerHTML = ""; wList.innerHTML = "";

            data.forEach(item => {
                let card = `<div class="list-card"><b>${item.content}</b><br><small><i class="far fa-calendar-alt"></i> ${item.date} ${item.time || ''}</small>`;
                if(item.category === 'æé†’') {
                    // Apple Calendar ç”Ÿæˆé‚è¼¯
                    const cleanDate = item.date.replace(/-/g, '');
                    const ics = `data:text/calendar;charset=utf8,BEGIN:VCALENDAR%0AVERSION:2.0%0ABEGIN:VEVENT%0ASUMMARY:${encodeURIComponent(item.content)}%0ADTSTART:${cleanDate}T090000Z%0ADTEND:${cleanDate}T100000Z%0AEND:VEVENT%0AEND:VCALENDAR`;
                    card += `<br><a class="calendar-link" href="${ics}" download="event.ics">ğŸ“… åŠ å…¥ Apple Calendar</a>`;
                    rList.innerHTML += card + `</div>`;
                } else {
                    wList.innerHTML += card + `</div>`;
                }
            });
            if(rList.innerHTML === "") rList.innerHTML = "ç›®å‰æ²’æœ‰æé†’äº‹é …";
            if(wList.innerHTML === "") wList.innerHTML = "ç›®å‰æ²’æœ‰é¡˜æœ›ç›®æ¨™";
        } catch (e) {
            console.error("è®€å–å¤±æ•—", e);
        }
    }

    // 5. æ–°å¢è³‡æ–™åˆ°é›²ç«¯
    async function addNewItem(type) {
        const content = prompt("è¼¸å…¥å…§å®¹ï¼š");
        if (!content) return;
        const date = prompt("æ—¥æœŸ (YYYY-MM-DD)ï¼š", new Date().toISOString().split('T')[0]);
        let time = "";
        if(type === 'æé†’') time = prompt("æ™‚é–“ (ä¾‹å¦‚ 10:00)ï¼š", "09:00");

        if (content && date) {
            // é¡¯ç¤ºç°¡æ˜“è¼‰å…¥æ„Ÿ
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            await fetch(SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify({ category: type, content, date, time })
            });
            
            btn.innerHTML = originalText;
            loadCloudData(); // é‡æ–°æ•´ç†é¡¯ç¤ºæœ€æ–°è³‡æ–™
        }
    }
</script>
</body>
</html>
